<!DOCTYPE html>
<html>
<head>
    <title>Manage animal</title>
    <script>
        window.onload = function() {
            loadAnimal();
        };

        function loadAnimal() {
            fetch(`{{ url_for('handle_animals') }}`)
                .then(response => response.json())
                .then(data => {
                    let animalList = document.getElementById("animalList");
                    animalList.innerHTML = "";
                    let animalOptions = document.getElementById("animalId");
                    animalOptions.innerHTML = "";

                    // Dodaj domyślną opcję wyboru
                    let defaultOption = document.createElement("option");
                    defaultOption.value = -1;
                    defaultOption.textContent = "Wybierz jedzenie";
                    animalOptions.appendChild(defaultOption);

                    data.forEach(animal => {
                        let animalItem = document.createElement("li");
                        animalItem.textContent = `Name:: ${animal.name}, Amount: ${animal.amount}, Weight: ${animal.weight}`;
                        animalList.appendChild(animalItem);

                        let animalOption = document.createElement("option");
                        animalOption.value = animal.id;
                        animalOption.textContent = animal.name;
                        document.getElementById("animalId").appendChild(animalOption);
                    });
                })
                .catch(error => console.error('Error:', error));
        }
        function handleActionChange() {
            var action = document.getElementById("action").value;
            var addanimalForm = document.getElementById("addanimalForm");
            var editanimalForm = document.getElementById("editanimalForm");
            var deleteanimalForm = document.getElementById("deleteanimalForm");
            var existinganimal = document.getElementById("existinganimal");

            if (action === "add") {
                addanimalForm.style.display = "block";
                editanimalForm.style.display = "none";
                deleteanimalForm.style.display = "none";
                existinganimal.style.display = "none";
            } else {
                if (action === "edit") {
                    addanimalForm.style.display = "none";
                    editanimalForm.style.display = "block";
                    deleteanimalForm.style.display = "none";
                } else if (action === "delete") {
                    addanimalForm.style.display = "none";
                    editanimalForm.style.display = "none";
                    deleteanimalForm.style.display = "block";
                }
                existinganimal.style.display = "block";
            }
        }

        function addAnimal(event) {
            event.preventDefault();
            let formData = new FormData(event.target);
            let jsonObject = {};
            for (const [key, value]  of formData.entries()) {
                jsonObject[key] = value;
            }
            fetch(`{{ url_for('handle_animals') }}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonObject)
            }).then(response => response.json())
            .then( data => {
                console.log(data)
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        };

        function deleteAnimal() {
            var animalId = document.getElementById("animalId").value;
            fetch(`{{ url_for('handle_animals') }}/`+animalId, {
                method: 'DELETE'
            })
            .then(response => console.log(response))
            .then(data => {
                console.log(data);
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        }

        function editAnimal(event) {
            event.preventDefault();
            var animalId = document.getElementById("animalId").value;
            let formData = new FormData(event.target);
            let jsonObject = {};
            for (const [key, value] of formData.entries()) {
                jsonObject[key] = value;
            }
            fetch(`{{ url_for('handle_animals') }}/`+animalId, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonObject)
            })
            .then(response => console.log(response))
            .then(data => {
                console.log(data);
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Manage animal</h1>
    <h2>Select action:</h2>
    <select id="action" onchange="handleActionChange()">
        <option value="add">Add</option>
        <option value="edit">Edit</option>
        <option value="delete">Delete</option>
    </select>

    <div id="existingAnimal" style="display: none;">
        <h2>Choose a animal:</h2>
        <select id="animalId">
            <option value="">Select a animal</option>
        </select>
    </div>

    <div id="addAnimalForm">
        <form method="POST" onsubmit="addAnimal(event)">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required><br>
    
            <label for="amount">Packs number:</label>
            <input type="number" id="amount" name="amount" required><br>
    
            <label for="weight">Single item weight:</label>
            <input type="number" id="weight" name="weight" step="0.1" required><br>
    
            <button type="submit">Add animal</button>
        </form>
    </div>

    <div id="editAnimalForm" style="display: none;">
        <h2>Edit animal</h2>
        <form method="POST" onsubmit="editAnimal(event)">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required><br>
    
            <label for="amount">Packs number:</label>
            <input type="number" id="amount" name="amount" required><br>
    
            <label for="weight">Single item weight:</label>
            <input type="number" id="weight" name="weight" step="0.1" required><br>   

            <button type="submit">Edit animal</button>
        </form>
    </div>

    <div id="deleteAnimalForm" style="display: none;">
        <h2>Delete animal</h2>
        <button onclick="deleteAnimal()">Delete</button>
    </div>

    <div></div>
        <h2>All animal:</h2>
        <ul id="animalList">
        </ul>
    </div>
</body>
</html>
