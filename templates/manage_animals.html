<!DOCTYPE html>
<html>
<head>
    <title>Manage animal</title>
    <script>
        window.onload = function() {
            loadAnimal();
        };

        function loadAnimal() {
            fetch(`{{ url_for('handle_animals') }}`)
                .then(response => response.json())
                .then(data => {
                    let animalList = document.getElementById("animalList");
                    animalList.innerHTML = "";
                    let animalOptions = document.getElementById("animalId");
                    animalOptions.innerHTML = "";

                    // Dodaj domyślną opcję wyboru
                    let defaultOption = document.createElement("option");
                    defaultOption.value = -1;
                    defaultOption.textContent = "Select an animal:";
                    animalOptions.appendChild(defaultOption);

                    data.forEach(animal => {
                        let animalItem = document.createElement("li");
                        animalItem.textContent = `Name: ${animal.name}, Race: ${animal.race}, Food_id: ${animal.food_id}, Shelter_id: ${animal.shelter_id}, Status: ${animal.status}, Sex: ${animal.sex}, Age: ${animal.age}, Weight: ${animal.weight}`;
                        animalList.appendChild(animalItem);

                        let animalOption = document.createElement("option");
                        animalOption.value = animal.id;
                        animalOption.textContent = animal.name;
                        document.getElementById("animalId").appendChild(animalOption);
                    });
                })
                .catch(error => console.error('Error:', error));
        }
        function handleActionChange() {
            var action = document.getElementById("action").value;
            var addAnimalForm = document.getElementById("addAnimalForm");
            var editAnimalForm = document.getElementById("editAnimalForm");
            var deleteAnimalForm = document.getElementById("deleteAnimalForm");
            var existingAnimal = document.getElementById("existingAnimal");

            if (action === "add") {
                addAnimalForm.style.display = "block";
                editAnimalForm.style.display = "none";
                deleteAnimalForm.style.display = "none";
                existingAnimal.style.display = "none";
            } else {
                if (action === "edit") {
                    addAnimalForm.style.display = "none";
                    editAnimalForm.style.display = "block";
                    deleteAnimalForm.style.display = "none";
                } else if (action === "delete") {
                    addAnimalForm.style.display = "none";
                    editAnimalForm.style.display = "none";
                    deleteAnimalForm.style.display = "block";
                }
                existingAnimal.style.display = "block";
            }
        }
        // przeanalizować czy dobrze jest wywołana funckja do przycisku edit animal - i ogarnąć logikę czyszczącą najlepiej dla wszystkich funkcji (dla add i edit)
        function clearingFunction() {
            editAnimalForm.style.display = "none";
            editAnimalForm.style.display = "block";
        }
        function addAnimal(event) {
            event.preventDefault();
            let formData = new FormData(event.target);
            let jsonObject = {};
            for (const [key, value]  of formData.entries()) {
                jsonObject[key] = value;
            }
            fetch(`{{ url_for('handle_animals') }}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonObject)
            }).then(response => response.json())
            .then( data => {
                console.log(data)
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        };

        function deleteAnimal() {
            var animalId = document.getElementById("animalId").value;
            fetch(`{{ url_for('handle_animals') }}/`+animalId, {
                method: 'DELETE'
            })
            .then(response => console.log(response))
            .then(data => {
                console.log(data);
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        }

        function editAnimal(event) {
            event.preventDefault();
            var animalId = document.getElementById("animalId").value;
            let formData = new FormData(event.target);
            let jsonObject = {};
            for (const [key, value] of formData.entries()) {
                jsonObject[key] = value;
            }
            fetch(`{{ url_for('handle_animals') }}/`+animalId, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonObject)
            })
            .then(response => console.log(response))
            .then(data => {
                console.log(data);
                loadAnimal();
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Manage animal</h1>
    <h2>Select action:</h2>
    <select id="action" onchange="handleActionChange()">
        <option value="add">Add</option>
        <option value="edit">Edit</option>
        <option value="delete">Delete</option>
    </select>

    <div id="existingAnimal" style="display: none;">
        <h2>Choose a animal:</h2>
        <select id="animalId">
            <option value="">Select a animal</option>
            <!-- jak wybieram zwierzę - stworzyć funkcję która załaduje do komórek dane zwierzęcia-->
        </select>
    </div>

    <div id="addAnimalForm">
        <form method="POST" onsubmit="addAnimal(event)">
            <form method="POST" onsubmit="editAnimal(event)" onsubmit="clearingFunction(event)">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required><br>
        
                <label for="race">Race:</label>
                <input type="text" id="race" name="race" required><br>
        
                <label for="food_id">Food Id:</label>
                <input type="number" id="food_id" name="food_id"  required><br>   
    
                <label for="shelter_id">Shelter_id:</label>
                <input type="number" id="shelter_id" name="shelter_id" required><br>   
    
                <label for="status">Status:</label>
                <input type="text" id="status" name="status" required><br>   
    
                <label for="sex">Sex:</label>
                <input type="text" id="sex" name="sex" required><br>   
    
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" step="0.1" required><br>   
    
                <label for="weight">Weight:</label>
                <input type="number" id="weight" name="weight" step="0.1" required><br>   

                <button type="submit">Add animal</button>  
<!-- na przycisku submit - albo dodać ID do niego anbo bezpośrednio wywołać nowy event z logiką, która wyczyści pola z komórek -->
        </form>
    </div>

    <div id="editAnimalForm" style="display: none;">
        <h2>Edit animal</h2>
        <form method="POST" onsubmit="editAnimal(event)">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required><br>
    
            <label for="race">Race:</label>
            <input type="text" id="race" name="race" required><br>
    
            <label for="food_id">Food Id:</label>
            <input type="number" id="food_id" name="food_id"  required><br>   

            <label for="shelter_id">Shelter_id:</label>
            <input type="number" id="shelter_id" name="shelter_id" required><br>   

            <label for="status">Status:</label>
            <input type="text" id="status" name="status" required><br>   

            <label for="sex">Sex:</label>
            <input type="text" id="sex" name="sex" required><br>   

            <label for="age">Age:</label>
            <input type="number" id="age" name="age" step="0.1" required><br>   

            <label for="weight">Weight:</label>
            <input type="number" id="weight" name="weight" step="0.1" required><br>   

            <button type="submit">Edit animal</button>
        </form>
    </div>

    <div id="deleteAnimalForm" style="display: none;">
        <h2>Delete animal</h2>
        <button onclick="deleteAnimal()">Delete</button>
    </div>

    <div></div>
        <h2>All animals:</h2>
        <ul id="animalList">
        </ul>
    </div>
</body>
</html>
